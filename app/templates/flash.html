<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Flash Deck</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>


  {% for c in cards %}
  <div class="col-lg-12 text-center">
    <p></p>
  </div>
    <div class="container" id="ele-{{ c.i }}" style="display: none;">
      <div id="card-id-{{ c.i }}" style="display: none;" >{{ c.id }}</div>
      <div class="row">
        <div class="col-lg-12 text-center">
          <p>{{ c.i }}/{{ exit_integer }}</p>
          <!-- <h1 class="mt-5">A Bootstrap 4 Starter Template</h1> -->
          <h1 class="mt-5">{{ c.questions[0] }}</h1>
          <h2 class="mt-5">{{ c.questions[1] }}</h2>
          <!-- <p class="lead">Complete with pre-defined file paths and responsive navigation!</p> -->
          <div id="card-answer-{{ c.i }}" style="display: none;">
            <ul class="list-unstyled">
              {% for a in c.answers %}
              <li>{{ a }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}

</body>

<script>
exit_integer = parseInt("{{ exit_integer }}")

  function showDiv(data) {
    $("#ele-" + data).show();
    hideElement(exit_integer, data);
  }

  function hideElement(total, active) {
    for (i = 0; i <= total; i++) {
      if (i != active)
        $("#ele-" + i).hide();
    }
  }

  function hideAnswers(total, active) {
    for (i = 0; i <= total; i++) {
      if (i != active)
        $("#card-answer-" + i).hide();
    }
    $("div[id*='card-answer']").each(function (i, el) {
         $('#'+el.id).hide()
     });
  }

  $(document).ready(function(){
    showDiv(counter);
});

var counter = 0
var dict = {"deck_id": "{{ deck_id }}"}
var shown = false
console.log(exit_integer)
document.addEventListener("keypress", function onPress(event) {
  if (event.key === "z") {
      id = $("#card-id-" + counter).text()
      counter++;
      dict[counter] = {id: id, result: 'z'}
      console.log(dict);
      $('#card-answer-' + counter).hide();
      showDiv(counter);
  } else if (event.key === "x") {
      id = $("#card-id-" + counter).text()
      counter++;
      dict[counter] = {id: id, result: 'x'}
      console.log(dict);
      $('#card-answer-'+counter).hide();
      showDiv(counter);
  } else if (event.key === "s") {
      $('#card-answer-'+counter).show()
  }
  if (counter === exit_integer) {
    fetch("{{ redirect_url }}", {
      method: "POST",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(dict)
    }).then(response => {
        if (response.redirected) {
            window.location.href = response.url;
        }
    })
    .catch(function(err) {
        console.info(err + " url: " + url);
    });
  }
});
window.onbeforeunload = function() {
  fetch("{{ redirect_url }}", {
      method: "POST",
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(dict)
    })
    console.log('POSTING')
return;
}

</script>

<!-- Bootstrap core JavaScript -->
<script src="{{ url_for('static', filename='bootstrap/js/bootstrap.bundle.min.js') }}"></script>
